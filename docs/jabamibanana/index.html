<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>じゃばみばなな</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=M+PLUS+Rounded+1c:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="text-gray-800 min-h-screen flex flex-col items-center p-4 sm:p-6 lg:p-8">
    
    <audio id="bgmAudio" loop></audio>
    <button id="muteButton" class="apple-button">🔇</button>

    <div class="w-full max-w-6xl">
        <header class="text-center mb-10">
            <div class="flex justify-center items-center gap-4 flex-wrap">
                 <h1 class="text-4xl sm:text-5xl font-extrabold text-yellow-400 cute-font flex justify-center items-center gap-2">
                    <img src="https://i.imgur.com/G3cbtBM.png" alt="icon" class="h-10 w-10 sm:h-12 sm:w-12 rounded-full">
                    じゃばみばなな
                    <img src="https://i.imgur.com/G3cbtBM.png" alt="icon" class="h-10 w-10 sm:h-12 sm:w-12 rounded-full" style="transform: scaleX(-1);">
                </h1>
                <button id="supportButton" class="apple-button bg-gradient-to-r from-yellow-400 via-red-500 to-pink-500 text-white font-bold py-2 px-4 rounded-full shadow-lg transition transform hover:scale-105 text-sm">
                    3兆円支援
                </button>
            </div>
            <p class="text-gray-800 mt-4 text-lg cute-font">がぞうを あっぷろーどし、ぷろんぷとで あたらしい びじゅあるを せいせいします。</p>
        </header>

        <main class="w-full">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-8">
                <!-- 元画像エリア -->
                <div class="card !p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-900">元になる画像</h2>
                    <div id="originalImageContainer" class="w-full bg-gray-50 rounded-xl overflow-hidden">
                        <div id="originalPlaceholder" class="placeholder rounded-xl">
                            <span class="text-center">ここに画像が表示されます</span>
                        </div>
                        <img id="originalImage" src="" class="hidden w-full h-full rounded-xl original-image" alt="Original Image">
                    </div>
                    <label id="imageSelectButton" for="imageUpload" class="apple-button image-button mt-6 inline-block w-full text-center font-semibold py-3 px-4 rounded-lg cursor-pointer">
                        画像を選択
                    </label>
                    <input type="file" id="imageUpload" class="hidden" accept="image/png, image/jpeg">
                </div>
                <!-- 生成画像エリア -->
                <div class="card !p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-900">できた画像</h2>
                    <div id="generatedImageContainer" class="w-full bg-gray-50 rounded-xl overflow-hidden relative placeholder cursor-pointer">
                        <div id="generatedPlaceholder" class="flex items-center justify-center w-full h-full">
                            <span class="text-center">ここに結果が表示されます</span>
                        </div>
                        <img id="generatedImage" src="" class="hidden w-full h-full generated-image" alt="Generated Image">
                        <div id="loader" class="absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center hidden">
                            <div class="loader"></div>
                        </div>
                    </div>
                     <a id="downloadButton" href="#" download="generated-jabami-banana.png" class="apple-button image-button mt-6 hidden w-full text-center font-semibold py-3 px-4 rounded-lg">画像を保存</a>
                     <p id="errorMessage" class="mt-4 text-red-600 font-semibold text-sm text-center h-5"></p>
                </div>
            </div>

            <!-- 操作エリア -->
            <div class="card">
                <div class="mb-6">
                    <label for="apiKey" class="block text-lg font-semibold mb-2 text-gray-700">
                        APIキー
                        <button id="helpButton" class="ml-2 text-blue-500 hover:text-blue-600 text-sm font-semibold">[?] ヘルプ</button>
                        <button id="settingsButton" class="ml-2 text-purple-500 hover:text-purple-600 text-sm font-semibold">[⚙️] 設定</button>
                    </label>
                    <div class="flex gap-2">
                        <input type="password" id="apiKey" class="flex-grow bg-gray-100 text-gray-800 rounded-lg p-3 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="ご自身のAPIキーを入力してください">
                        <button id="saveApiKeyButton" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">保存</button>
                    </div>
                </div>

                <div class="mb-6">
                    <label for="prompt" class="block text-lg font-semibold mb-2 text-gray-700">プロンプト</label>
                    <textarea id="prompt" rows="3" class="w-full bg-gray-100 text-gray-800 rounded-lg p-3 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="例: a girl with silver hair in a futuristic city"></textarea>
                </div>

                <div class="flex flex-wrap gap-3 mb-8">
                    <button id="realFigureButton" onclick="setPrompt('figure_realistic')" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">リアルフィギュア</button>
                    <button id="nendoroidButton" onclick="setPrompt('figure_nendoroid')" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">ねんどろいど</button>
                    <button id="animeModernButton" onclick="setPrompt('anime_modern')" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">アニメ風</button>
                    <button id="anime90sButton" onclick="setPrompt('anime_90s')" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">90年代アニメ</button>
                    <button id="realisticButton" onclick="setPrompt('realistic')" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">実写風</button>
                    <button id="illustrationButton" onclick="setPrompt('illustration')" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">イラスト</button>
                    <button id="pixelArtButton" onclick="setPrompt('pixel_art')" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">ドット絵</button>
                    <button id="cyberpunkButton" onclick="setPrompt('cyberpunk')" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">サイバーパンク</button>
                    <button id="watercolorButton" onclick="setPrompt('watercolor')" class="apple-button image-button font-semibold py-2 px-4 rounded-lg">水彩画</button>
                </div>

                <button id="generateButton" class="apple-button image-button w-full text-white font-bold py-4 px-4 rounded-lg text-lg">
                    生成する
                </button>
            </div>
        </main>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-40 hidden modal-overlay">
        <div id="helpModalContent" class="text-white w-11/12 max-w-2xl mx-auto rounded-2xl shadow-xl p-6 md:p-8 relative max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold mb-4">ヘルプ</h3>
            <div class="space-y-6">
                <div>
                    <h4 class="text-xl font-semibold mb-2">APIキーの設定方法</h4>
                    <ol class="list-decimal list-inside space-y-3 text-gray-200">
                        <li><a href="https://aistudio.google.com/" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline font-semibold">Google AI Studio</a> にGoogleアカウントでログインします。</li>
                        <li>ページ上部にある「<strong class="font-semibold text-white">Get API key</strong>」ボタンをクリックします。</li>
                        <li>「<strong class="font-semibold text-white">Create API key in new project</strong>」を選択して新しいキーを作成します。</li>
                        <li>生成されたAPIキーをコピーし、このツールの「APIキー」入力欄に貼り付け、「保存」ボタンを押してください。</li>
                    </ol>
                </div>
                 <div>
                    <h4 class="text-xl font-semibold mb-2">トラブルシューティング</h4>
                    <p class="text-gray-300 mb-3">画像生成がうまくいかない場合は、以下を確認してください。</p>
                    <ul class="list-disc list-inside space-y-3 text-gray-200">
                        <li><strong class="font-semibold text-white">APIキーは正しいですか？</strong> コピーする際に、前後に余計な空白が入っていないか、文字列が途中で切れていないか、もう一度ご確認ください。</li>
                        <li><strong class="font-semibold text-white">エラーメッセージを確認しましたか？</strong> 生成ボタンの下に赤色でエラーの原因が表示されます。</li>
                        <li><strong class="font-semibold text-white">Googleのプロジェクト設定は有効ですか？</strong> エラーメッセージに従いGoogle Cloud Consoleで設定を確認する必要があります。</li>
                         <li><strong class="font-semibold text-white">シークレットモードで試しましたか？</strong> ブラウザの拡張機能が干渉している可能性があります。</li>
                    </ul>
                </div>
            </div>
            <button id="closeModalButton" class="absolute top-4 right-4 text-gray-300 hover:text-white text-3xl">&times;</button>
        </div>
    </div>
    
    <!-- Image Viewer Modal -->
    <div id="imageModal" class="fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-80 hidden modal-overlay">
        <div class="relative w-11/12 max-w-4xl max-h-[90vh]">
            <img id="modalImage" src="" class="w-full h-full object-contain rounded-lg" alt="Generated Image Full View">
            <button id="closeImageModalButton" class="apple-button absolute -top-2 -right-2 sm:top-2 sm:right-2 text-white bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-75 text-2xl">&times;</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-60 hidden modal-overlay">
        <div id="settingsModalContent" class="text-white w-11/12 max-w-3xl mx-auto rounded-2xl shadow-xl relative flex items-center justify-center" style="height: 60vh;">
            <div class="p-8">
                 <h2 class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-center cute-font" style="text-shadow: 0px 3px 6px rgba(0, 0, 0, 0.7);">設定することありませーんｗｗｗｗ</h2>
            </div>
            <button id="closeSettingsModalButton" class="absolute top-4 right-4 text-white hover:text-gray-200 text-4xl opacity-80 hover:opacity-100">&times;</button>
        </div>
    </div>

    <!-- Support Modal -->
    <div id="supportModal" class="fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-60 hidden modal-overlay">
        <div id="supportModalContent" class="text-white w-11/12 max-w-2xl mx-auto rounded-2xl shadow-xl relative flex items-center justify-center p-8 text-center" style="height: 60vh;">
            <div>
                 <p class="text-3xl sm:text-4xl font-extrabold cute-font" style="text-shadow: 0px 2px 5px rgba(0, 0, 0, 0.8);">支援してくれてありがとう！</p>
                 <p class="text-2xl sm:text-3xl mt-4 font-bold cute-font" style="text-shadow: 0px 2px 5px rgba(0, 0, 0, 0.8);">気持ちだけ受け取っておくね？</p>
                 <p class="text-3xl sm:text-4xl mt-6 font-extrabold cute-font" style="text-shadow: 0px 2px 5px rgba(0, 0, 0, 0.8);">お礼にこれどうぞ❤</p>
            </div>
            <button id="closeSupportModalButton" class="absolute top-4 right-4 text-white hover:text-gray-200 text-4xl opacity-80 hover:opacity-100">&times;</button>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-900 text-white py-2 px-5 rounded-lg shadow-lg opacity-0 transform translate-y-5 toast">
        <p id="toastMessage"></p>
    </div>

    <script src="script.js"></script>
</body>
</html>
